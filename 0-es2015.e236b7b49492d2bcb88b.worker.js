!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,(function(key){return value[key]}).bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="iVMD")}({"1gqn":function(module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},KKCa:function(module,exports){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},MCLT:function(module,exports,__webpack_require__){var getOwnPropertyDescriptors=Object.getOwnPropertyDescriptors||function(obj){for(var keys=Object.keys(obj),descriptors={},i=0;i<keys.length;i++)descriptors[keys[i]]=Object.getOwnPropertyDescriptor(obj,keys[i]);return descriptors},formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}i=1;for(var args=arguments,len=args.length,str=String(f).replace(formatRegExp,(function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}})),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){if("undefined"!=typeof process&&!0===process.noDeprecation)return fn;if("undefined"==typeof process)return function(){return exports.deprecate(fn,msg).apply(this,arguments)};var warned=!1;return function(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}};var debugEnviron,debugs={};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=function(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=function(array){var hash={};return array.forEach((function(val,idx){hash[val]=!0})),hash}(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value))return ctx.stylize("[Function"+(value.name?": "+value.name:"")+"]","special");if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var output,base="",array=!1,braces=["{","}"];return isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)&&(base=" [Function"+(value.name?": "+value.name:"")+"]"),isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0!==keys.length||array&&0!=value.length?recurseTimes<0?isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special"):(ctx.seen.push(value),output=array?function(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach((function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))})),output}(ctx,value,recurseTimes,visibleKeys,keys):keys.map((function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})),ctx.seen.pop(),function(output,base,braces){return output.reduce((function(prev,cur){return cur.indexOf("\n"),prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}(output,base,braces)):braces[0]+base+braces[1]}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if((desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]}).get?str=ctx.stylize(desc.set?"[Getter/Setter]":"[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1)).indexOf("\n")>-1&&(str=array?str.split("\n").map((function(line){return"  "+line})).join("\n").substr(2):"\n"+str.split("\n").map((function(line){return"   "+line})).join("\n")):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;(name=JSON.stringify(""+key)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=function(arg){return null==arg},exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=function(arg){return"symbol"==typeof arg},exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=function(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg},exports.isBuffer=__webpack_require__("1gqn");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=__webpack_require__("KKCa"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin};var kCustomPromisifiedSymbol="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function callbackifyOnRejected(reason,cb){if(!reason){var newReason=new Error("Promise was rejected with a falsy value");newReason.reason=reason,reason=newReason}return cb(reason)}exports.promisify=function(original){if("function"!=typeof original)throw new TypeError('The "original" argument must be of type Function');if(kCustomPromisifiedSymbol&&original[kCustomPromisifiedSymbol]){var fn;if("function"!=typeof(fn=original[kCustomPromisifiedSymbol]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:!1,writable:!1,configurable:!0}),fn}function fn(){for(var promiseResolve,promiseReject,promise=new Promise((function(resolve,reject){promiseResolve=resolve,promiseReject=reject})),args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);args.push((function(err,value){err?promiseReject(err):promiseResolve(value)}));try{original.apply(this,args)}catch(err){promiseReject(err)}return promise}return Object.setPrototypeOf(fn,Object.getPrototypeOf(original)),kCustomPromisifiedSymbol&&Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(fn,getOwnPropertyDescriptors(original))},exports.promisify.custom=kCustomPromisifiedSymbol,exports.callbackify=function(original){if("function"!=typeof original)throw new TypeError('The "original" argument must be of type Function');function callbackified(){for(var args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);var maybeCb=args.pop();if("function"!=typeof maybeCb)throw new TypeError("The last argument must be of type Function");var self=this,cb=function(){return maybeCb.apply(self,arguments)};original.apply(this,args).then((function(ret){process.nextTick(cb,null,ret)}),(function(rej){process.nextTick(callbackifyOnRejected,rej,cb)}))}return Object.setPrototypeOf(callbackified,Object.getPrototypeOf(original)),Object.defineProperties(callbackified,getOwnPropertyDescriptors(original)),callbackified}},iVMD:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);const environment=Object.assign({production:!0},{chess:{width:8,height:8},computation:{enableWorker:!0,iterative:!0,delay:{current:50,min:5,max:1e3,step:1}},listThrottleTime:50});function randomArrayValue(array){return array[Math.floor(Math.random()*array.length)]}function randomArrayOfValues(values,length){return Array.from({length:length},()=>randomArrayValue(values))}function randomArrayMutate(array,values,mutationProbability){for(let i=0;i<array.length;i++)Math.random()<mutationProbability&&(array[i]=randomArrayValue(values))}function utils_breed(a1,a2){const result=a1.slice();for(let i=0;i<a1.length;i++)Math.random()<.5&&(result[i]=a2[i]);return result}function isArray(arr){return arr instanceof Array}function primitiveArrayEquals(a1,a2){if(a1===a2||!a1&&!a2)return!0;if(!a1||!a2)return!1;if(!isArray(a1)||!isArray(a2))return!1;if(a1.length!==a2.length)return!1;for(let i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}function round(value){return Math.round(1e4*value)/1e4}var Alphabet=function(Alphabet){return Alphabet.Zero="0",Alphabet.One="1",Alphabet.PassThrough="#",Alphabet}({});const ALPHABET=[Alphabet.Zero,Alphabet.One,Alphabet.PassThrough];let message_Message=(()=>{class Message{constructor(value,classifier){this.value=value,this.classifier=classifier,this._wasUsed=!1}get size(){return this.value.length}static isMessageOfType(message,type){return message[0]===type[0]&&message[1]===type[1]}static makeAsMessageOfType(message,type){message[0]=type[0],message[1]=type[1]}get wasUsed(){return this._wasUsed}use(){this._wasUsed=!0}}return Message.OUTPUT_INTERNAL_TYPE=[Alphabet.Zero,Alphabet.One],Message.INPUT_INTERNAL_TYPE=[Alphabet.One,Alphabet.One],Message.OUTPUT_EXTERNAL_TYPE=[Alphabet.Zero,Alphabet.Zero],Message.INPUT_EXTERNAL_TYPE=[Alphabet.One,Alphabet.Zero],Message.MESSAGE_PREFIX_LENGTH=2,Message})();class IdScheduler{constructor(id=0){this._currentId=0,this._currentId=id}static from(id){return new IdScheduler(id._currentId)}requestNew(){return++this._currentId}next(){return this._currentId+1}}let classifier_Classifier=(()=>{class Classifier{constructor(condition,action,id=Classifier.idScheduler.requestNew()){this.condition=condition,this.action=action,this.id=id,this._strength=1,this.active=!1,this._currentBidAmount=0,this._lived=0,this.messages=[],this.specifity=Classifier.calculateSpecifity(condition)}get view(){return this._view||(this._view={action:this.action.join(""),condition:this.condition.join(""),id:this.id,specifity:round(this.specifity),strength:round(this._strength),lived:this._lived}),this._view}set strength(v){this._strength=v,this._view=null}get strength(){return this._strength}get maxBidAmount(){return this._strength*this.specifity}get currentBidAmount(){return this._currentBidAmount}static newInstanceFrom({action:action,condition:condition}){return new Classifier(condition.slice(),action.slice())}static onReset(){this.idScheduler=new IdScheduler}static onBreedAccepted(){this.idScheduler.requestNew()}static copy(classifier){const newCls=new Classifier(classifier.condition.slice(),classifier.action.slice(),classifier.id);return newCls._strength=classifier._strength,newCls._view=classifier._view,newCls._lived=classifier._lived,newCls._currentBidAmount=classifier._currentBidAmount,newCls.active=classifier.active,classifier.messages.length>0&&newCls.messages.push(...classifier.messages),newCls}static fromLengths(conditionLen,actionLen){const actions=randomArrayOfValues(ALPHABET,actionLen);return message_Message.makeAsMessageOfType(actions,message_Message.OUTPUT_EXTERNAL_TYPE),new Classifier(randomArrayOfValues(ALPHABET,conditionLen),actions)}static fromString(condition,action){const conditionAlphabet=Classifier.validateAlphabetString(condition,"condition"),actionAlphabet=Classifier.validateAlphabetString(action,"action");return new Classifier(conditionAlphabet,actionAlphabet)}static validateAlphabetString(str,role){const strAlphabet=str.split("");if(strAlphabet.some(v=>!ALPHABET.includes(v)))throw Error(`Illegal value in ${role}: '${str}', allowed are [${ALPHABET.join(", ")}]`);return strAlphabet}static equal(c1,c2){return c1===c2||!c1&&!c2||!(!c1||!c2)&&c1 instanceof Classifier&&c2 instanceof Classifier&&primitiveArrayEquals(c1.action,c2.action)&&primitiveArrayEquals(c1.condition,c2.condition)}static calculateSpecifity(condition){let counter=0;for(const c of condition)c===Alphabet.PassThrough&&++counter;return(condition.length-counter)/condition.length}newEpoch(){++this._lived,this._view&&++this._view.lived}payBid(k,tax){return this._currentBidAmount=this.maxBidAmount*k,this._strength-=this._currentBidAmount*tax,this._view=null,this._currentBidAmount}pay(amount){this._strength+=amount,this._view=null}payTax(life){this._strength-=this._strength*life,this._view=null}activate(message){const result=this.action.slice();for(let i=0;i<result.length;i++)result[i]===Alphabet.PassThrough&&(result[i]=message.value[i]);const activatedMessage=new message_Message(result,this);return this.messages.push(activatedMessage),activatedMessage}isOutput(){return message_Message.isMessageOfType(this.action,message_Message.OUTPUT_EXTERNAL_TYPE)}asOutput(){message_Message.makeAsMessageOfType(this.action,message_Message.OUTPUT_EXTERNAL_TYPE)}clearMessages(){this.messages.length=0}match(message){if(message.size===this.condition.length){for(let i=0;i<this.condition.length;i++){const value=this.condition[i];if(value!==Alphabet.PassThrough&&value!==message.value[i])return void(this.active=!1)}return message.use(),this.active=!0,this.activate(message)}}dumpMessagesAndPay(){return 0!==this.messages.length&&(this.strength+=this.currentBidAmount),this.messages}mutate(mutationProbability){randomArrayMutate(this.condition,ALPHABET,mutationProbability),randomArrayMutate(this.action,ALPHABET,mutationProbability)}breed(classifier){const condition=utils_breed(this.condition,classifier.condition),action=utils_breed(this.action,classifier.action);return new Classifier(condition,action,Classifier.idScheduler.next())}inverseCopy(){const copy=Classifier.newInstanceFrom(this),lastElementIndex=copy.action.length-1;return copy.action[lastElementIndex]=copy.action[lastElementIndex]===Alphabet.One?Alphabet.Zero:Alphabet.One,copy.strength=this._strength+.1,copy}}return Classifier.idScheduler=new IdScheduler,Classifier})();class Algorithm{constructor(cfg){this.cfg=Object.assign({},cfg)}update(cfg){Object.assign(this.cfg,cfg)}}const GAClassifiersComparator=(a,b)=>b.strength-a.strength;class genetic_algorithm_GeneticAlgorithm extends Algorithm{constructor(cfg,messageConfig){super(cfg),this.messageLength=messageConfig.messageLength}execute(classifiers){classifiers.sort(GAClassifiersComparator);const outNo=this.removeClassifiersWithToLowStrength(classifiers),afterBreed=this.breed(classifiers);afterBreed.length>0&&classifiers.push(...afterBreed),this.mutateClassifiers(classifiers),this.makeAsExternalOutput(classifiers,outNo)}removeClassifiersWithToLowStrength(classifiers){let outNo=0;for(let i=classifiers.length-1;i>=0&&classifiers.length>2;i--){const classifier=classifiers[i];classifier.newEpoch(),classifier.strength<this.cfg.strengthThreshold?classifiers.splice(i,1):classifier.isOutput()&&++outNo}return outNo}breed(classifiers){const breed=[];let kb=0;if(classifiers.length<2)return breed;let second,first=classifiers[0];for(let i=1;i<classifiers.length&&kb<this.cfg.breedingLimit&&classifiers.length<this.cfg.maxClassifiers;i++){second=classifiers[i];let candidate,j=0;do{if(candidate=first.breed(second),++j>100){if(i>=classifiers.length-1){candidate=classifier_Classifier.fromLengths(this.messageLength,this.messageLength);continue}first=second,second=classifiers[++i]}}while(classifiers.find(c=>classifier_Classifier.equal(c,candidate))||breed.find(c=>classifier_Classifier.equal(c,candidate)));candidate&&(classifier_Classifier.onBreedAccepted(),breed.push(candidate),first=second,++kb)}return breed}mutateClassifiers(classifiers){for(let i=Math.floor(classifiers.length*this.cfg.elitism);i<classifiers.length;i++)Math.random()<this.cfg.mutationProbability&&classifiers[i].mutate(this.cfg.classifierMutationProbability)}makeAsExternalOutput(classifiers,outNo){const maxOutNo=Math.floor(classifiers.length*this.cfg.outPercentage);for(let i=classifiers.length-1;i>=0&&outNo<maxOutNo;i--){const classifier=classifiers[i];classifier.isOutput()||(classifier.asOutput(),++outNo)}}}const BBClassifiersComparator=(c1,c2)=>c2.maxBidAmount-c1.maxBidAmount;class bucket_brigade_BucketBrigade extends Algorithm{constructor(cfg){super(cfg),this.activated=[]}matchCompete(classifiers,messages){const active=this.findActiveClassifiers(classifiers,messages),{winners:winners,newMessages:newMessages}=this.getWinners(active);return this.activated=winners,0===newMessages.length?messages.slice():[...messages,...newMessages]}payCurrentClassifiers(amount){this.activated.forEach(c=>c.pay(amount))}invertedCopy(classifiers){const classifiersSet=[];for(const c of this.activated){const candidate=c.inverseCopy();let existing=classifiers.find(cs=>classifier_Classifier.equal(cs,candidate));existing||(existing=classifiersSet.find(cs=>classifier_Classifier.equal(cs,candidate)))?existing.strength=1.01*c.strength:classifiersSet.push(candidate)}classifiersSet.length>0&&classifiers.push(...classifiersSet)}getWinners(classifiers){const winners=classifiers.slice(0,this.cfg.winners),newMessages=[];return winners.forEach(w=>{w.payBid(this.cfg.k,this.cfg.bidTax),newMessages.push(...w.dumpMessagesAndPay())}),{winners:winners,newMessages:newMessages}}findActiveClassifiers(classifiers,messages){const active=[];for(const c of classifiers)c.clearMessages(),c.payTax(this.cfg.lifeTax),this.matchClassifierMessages(messages,c,active);return active.sort(BBClassifiersComparator),active}matchClassifierMessages(messages,classifier,active){messages.forEach(message=>{classifier.match(message)&&active.push(classifier)})}}class message_factory_MessageFactory{constructor(config){this.config=config}numberToBinary(value,targetLength){const word=value.toString(2).split("");for(;word.length<targetLength;)word.unshift(Alphabet.Zero);return word}fromCoords(x,y){const xBinary=this.numberToBinary(x,this.config.widthCoordLength),yBinary=this.numberToBinary(y,this.config.heightCoordLength);return new message_Message([...message_Message.INPUT_EXTERNAL_TYPE,...xBinary,...yBinary])}random(){return classifier_Classifier.fromLengths(this.config.messageLength,this.config.messageLength)}}function matrix(width,height,supplier){return Array.from({length:width},(_,x)=>Array.from({length:height},(_,y)=>supplier(x,y)))}var util=__webpack_require__("MCLT");function initialPrediction(){return{result:Alphabet.PassThrough,accuracy:0}}const worker=new class{constructor(width,height,refreshStep=10,computationDelay=50,messageConsumer){this.width=width,this.height=height,this.refreshStep=refreshStep,this.computationDelay=computationDelay,this.messageConsumer=messageConsumer,this.ga=null,this.bb=null,this.expectedClassifiersNumber=0,this.messageCfg=null,this.classifiers=[],this.runningId=0,this.isRunning=!1,this.messageFactory=null,this.pattern=null,this.currentIndex=0,this.isIterative=!0}postMessage(message){if("number"==typeof message.computationDelay&&(this.computationDelay=message.computationDelay),message.pattern&&(this.pattern=message.pattern),message.msgCfg)this.messageCfg=message.msgCfg,this.messageFactory=new message_factory_MessageFactory(message.msgCfg);else if((message.gaCfg||message.bbCfg)&&!this.messageCfg)throw Error("Message cfg is not set");this.assignGACfgIfDefined(message.gaCfg,this.messageCfg),this.assignBBCfgIfDefined(message.bbCfg),"number"==typeof message.classifiersNumber&&this.updateClassifiersNumber(message.classifiersNumber),message.reset&&this.reset(),message.newClassifier&&this.addNewClassifier(message.newClassifier),"number"==typeof message.removeClassifier&&this.removeClassifier(message.removeClassifier),Object(util.isBoolean)(message.iterative)&&(this.isIterative=message.iterative),"boolean"==typeof message.running&&(this.isRunning=message.running,message.running&&this.fireComputation())}fireComputation(){this.recentInvocation=(new Date).getTime(),this.run(++this.runningId)}updateClassifiersNumber(newNumber){if(this.expectedClassifiersNumber=newNumber,this.classifiers.length===newNumber)return;const currentClassifiers=this.classifiers.slice();if(currentClassifiers.length>newNumber)currentClassifiers.length=newNumber;else for(;currentClassifiers.length<newNumber;)currentClassifiers.push(this.messageFactory.random());this.classifiers=currentClassifiers,this.messageConsumer({classifiers:this.classifiers})}reset(){classifier_Classifier.onReset(),this.classifiers=Array.from({length:this.expectedClassifiersNumber},()=>this.messageFactory.random()),this.currentIndex=0,this.messageConsumer({classifiers:this.classifiers,prediction:this.initialPrediction(),accuracy:0,messages:[]})}assignGACfgIfDefined(gaCfg,msgCfg){gaCfg&&(this.ga?this.ga.update(gaCfg):this.ga=new genetic_algorithm_GeneticAlgorithm(gaCfg,msgCfg))}assignBBCfgIfDefined(bbCfg){bbCfg&&(this.bb?this.bb.update(bbCfg):this.bb=new bucket_brigade_BucketBrigade(bbCfg))}run(runId){const interval=setInterval(()=>{if(!this.isRunning||this.runningId!==runId)return void clearInterval(interval);const currentTime=(new Date).getTime();currentTime-this.recentInvocation>=this.computationDelay&&(this.recentInvocation=currentTime,this.isIterative?this.makeSingleIteration():this.makeFullRun())},this.refreshStep)}makeFullRun(){let classifiers=this.classifiers.slice();const allMessages=[];let totalAccuracy=0;const totalPrediction=matrix(this.width,this.height,()=>null);for(let x=0;x<this.width;x++)for(let y=0;y<this.height;y++){const{messages:messages,accuracy:accuracy,prediction:prediction}=this.predictForCoordinates(classifiers,x,y);totalAccuracy+=accuracy,allMessages.push(...messages),totalPrediction[x][y]=prediction}this.classifiers=classifiers,this.messageConsumer({prediction:totalPrediction,classifiers:classifiers,messages:allMessages,accuracy:totalAccuracy/(this.width*this.height)})}makeSingleIteration(){const classifiers=this.classifiers.slice(),x=Math.floor(this.currentIndex/this.width),y=this.currentIndex%this.height;this.currentIndex=++this.currentIndex%(this.height*this.width);const{messages:messages,accuracy:accuracy,prediction:prediction}=this.predictForCoordinates(classifiers,x,y);this.classifiers=classifiers,this.messageConsumer({x:x,y:y,prediction:prediction,classifiers:classifiers,messages:messages,accuracy:accuracy})}predictForCoordinates(classifiers,x,y){const messages=this.bb.matchCompete(classifiers,[this.messageFactory.fromCoords(x,y)]),response=this.getClassifiersAggregatedResponse(messages),accuracy=this.computeAccuracy(x,y,response);return 0===accuracy&&-1!==response&&this.bb.invertedCopy(classifiers),this.bb.payCurrentClassifiers(accuracy),this.ga.execute(classifiers),{messages:messages,accuracy:accuracy,prediction:{result:this.getClassifiersPrediction(response),accuracy:accuracy}}}initialPrediction(){return matrix(this.width,this.height,initialPrediction)}getClassifiersPrediction(fuzzyResponse){return-1===fuzzyResponse?Alphabet.PassThrough:fuzzyResponse>.5?Alphabet.One:Alphabet.Zero}computeAccuracy(x,y,fuzzyResponse){return-1===fuzzyResponse?0:this.pattern.value[x][y]===Alphabet.Zero?1-fuzzyResponse:fuzzyResponse}getClassifiersAggregatedResponse(messages){let ret=0,totalOutputMessages=0;return messages.forEach(m=>{const message=m.value;message_Message.isMessageOfType(message,message_Message.OUTPUT_EXTERNAL_TYPE)&&(ret+=this.getAlphabetValue(message[message.length-1]),totalOutputMessages++)}),0===totalOutputMessages?-1:ret<0?-1:ret/totalOutputMessages}getAlphabetValue(value){return value===Alphabet.One?1:value===Alphabet.Zero?0:-1}addNewClassifier(newClassifier){this.classifiers.push(classifier_Classifier.newInstanceFrom(newClassifier)),this.messageConsumer({classifiers:this.classifiers})}removeClassifier(classifierId){this.classifiers=this.classifiers.filter(c=>c.id!==classifierId),this.messageConsumer({classifiers:this.classifiers})}}(environment.chess.width,environment.chess.height,environment.computation.delay.step,environment.computation.delay.current,m=>postMessage(m));addEventListener("message",({data:data})=>worker.postMessage(data))}});